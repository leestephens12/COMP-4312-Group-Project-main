/*!
 * @amoy/filter-page-curl - v3.0.21
 * Compiled Thu, 21 Nov 2019 07:47:39 UTC
 *
 * @amoy/filter-page-curl is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var __filters=function(t,e){"use strict";var i="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",s="varying vec2 vTextureCoord;//passed from vect shader \n\nuniform sampler2D uSampler;// 2d texture\nuniform sampler2D nextPageTexture;// 2d texture\n\nuniform vec4 filterArea;\n\nuniform float uPosx;\nuniform float uPosy;\nuniform float uStartPosx;\nuniform float uStartPosy;\nuniform float uRadius;//翻卷半径\nuniform int uFlipmode;//反向翻转模式 0 or 1\n\n\n#define pi 3.14159265359\n//#define uRadius .04\n\n#define iResolution filterArea\n#define iTime uTime\n#define fragColor gl_FragColor\n#define texture texture2D\n\nvoid main(void)\n{\n\tfloat aspect=iResolution.x/iResolution.y;\n\tfloat radius = uRadius;\n\n\tvec2 uv=vTextureCoord*filterArea.xy*vec2(aspect,1.)/iResolution.xy;\n\tvec2 maxuv = filterArea.xy*vec2(aspect,1.)/iResolution.xy;\n\tif(uFlipmode > 0){\n\t\tuv.x = maxuv.x - uv.x;\n\t}else{\n\t\tvec2 maxuv = vec2(1.0);\n\t}\n\t\n\tvec4 virtualMouse=vec4(uPosx,uPosy,uStartPosx,uStartPosy);\n\tvec2 mouse=virtualMouse.xy*vec2(aspect,1.)/iResolution.xy;\n\tvec2 mouseDir=normalize(abs(virtualMouse.zw)-virtualMouse.xy);\n\tvec2 origin=clamp(mouse-mouseDir*mouse.x/mouseDir.x,0.,1.);\n\t\n\tfloat mouseDist=clamp(length(mouse-origin)+(aspect-(abs(virtualMouse.z)/iResolution.x)*aspect)/mouseDir.x,0.,aspect/mouseDir.x);\n\t\n\tif(mouseDir.x<0.)\n\t{\n\t\tmouseDist=distance(mouse,origin);\n\t}\n\t\n\tfloat proj=dot(uv-origin,mouseDir);\n\tfloat dist=proj-mouseDist;\n\t\n\tvec2 linePoint=uv-dist*mouseDir;\n\t\n\tif(dist>radius)\n\t{\n\t\t//下一页面\n\t\tif(uFlipmode > 0){\n\t\t\tuv.x = maxuv.x- uv.x;\n\t\t}\n\t\tfragColor=texture(nextPageTexture,uv*vec2(1./aspect,1.));\n\t\tfragColor.rgb*= clamp(min(.99, .5 + 1. - radius/.04), 1.0, pow(clamp((dist-radius)*14.0,0.,1.),max(.05,5.*radius)));\n\t}\n\telse if(dist>=0.)\n\t{\n\t\t// 圆柱面点映射\n\t\tfloat theta=asin(dist/radius);\n\t\tvec2 p2=linePoint+mouseDir*(pi-theta)*radius;\n\t\tvec2 p1=linePoint+mouseDir*theta*radius;\n\t\tif(p2.x<=aspect&&p2.y<=1.&&p2.x>0.&&p2.y>0.){\n\t\t\tuv = p2;\n\t\t\t//背面页 圆柱面\n\t\t\tif(uFlipmode > 0){\n\t\t\t\tuv = (maxuv- uv*vec2(1./aspect,1.));\n\t\t\t\tuv.y = maxuv.y- uv.y;\n\t\t\t\tuv.x = maxuv.x- uv.x;\n\t\t\t}else{\n\t\t\t\tuv = (1.0- uv*vec2(1./aspect,1.));\n\t\t\t\tuv.y = 1.0- uv.y;\n\t\t\t}\n\t\t\tfragColor = texture(nextPageTexture, uv);\n\t\t\tfragColor.rgb*=clamp(min(.99, .6 + 1. - uRadius/.04), 1.0, pow(clamp((radius-dist)/radius,0.,1.), max(.05,5.*radius)));\n\t\t\tfragColor.a = 1.;\n\t\t}else{\n\t\t\t//corer 圆角\n\t\t\tuv = p1;\n\t\t\tif(uFlipmode > 0){\n\t\t\t\tuv.x = maxuv.x- uv.x;\n\t\t\t}\n\t\t\tfragColor = texture(uSampler, uv * vec2(1. / aspect, 1.));\n\t\t\tfragColor.rgb*=clamp(.94, 1.0, pow(clamp((radius-dist)/radius,0.,1.),max(.05,5.*radius)));\n\t\t}\n\t}\n\telse\n\t{\n\t\tvec2 p=linePoint+mouseDir*(abs(dist)+pi*radius);\n\t\tif(p.x<=aspect&&p.y<=1.&&p.x>0.&&p.y>0.&&length(mouseDir)>0.){\n\t\t\tuv = p ;\n\t\t\t// 背面页平面区域\n\t\t\tif(uFlipmode > 0){\n\t\t\t\tuv = (maxuv - uv*vec2(1./aspect,1.));\n\t\t\t\tuv.y = maxuv.y - uv.y;\n\t\t\t\tuv.x = maxuv.x- uv.x;\n\t\t\t}else{\n\t\t\t\tuv = (1.0 - uv*vec2(1./aspect,1.));\n\t\t\t\tuv.y = 1.0 - uv.y;\n\t\t\t}\n\t\t\tfragColor=texture(nextPageTexture,uv);\n\t\t\tfragColor.a = 1.;\n\t\t}else{\n\t\t\t// 正面页面\n\t\t\tif(uFlipmode > 0){\n\t\t\t\tuv.x = maxuv.x- uv.x;\n\t\t\t}\n\t\t\tfragColor=texture(uSampler,uv*vec2(1./aspect,1.));\n\t\t}\n\t\t\n\t}\n}",n=function(t){function n(e,n,o,u,r,a,x){void 0===e&&(e=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===u&&(u=0),void 0===a&&(a=.04),void 0===x&&(x=!1),t.call(this,i,s),this.posx=e,this.posy=n,this._size=0,this._sliceSize=0,this._slicePixelSize=0,this._sliceInnerSize=0,this._flipMode=x,this._scaleMode=null,this.radius=a,this.startPosx=o,this.startPosy=u,this.nextPageTexture=r}t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n;var o={flipMode:{configurable:!0},posx:{configurable:!0},radius:{configurable:!0},posy:{configurable:!0},startPosx:{configurable:!0},startPosy:{configurable:!0},nextPageTexture:{configurable:!0}};return n.prototype.apply=function(t,e,i,s){this.uniforms.uPosx=this.posx<=0?0:this.posx,this.uniforms.uPosy=this.posy<=0?0:this.posy,this.uniforms.uRadius=this.radius,this.uniforms.uFlipmode=this._flipMode?1:0,this.uniforms.uStartPosx=this.startPosx<=0?0:this.startPosx,this.uniforms.uStartPosy=this.startPosy<=0?0:this.startPosy,t.applyFilter(this,e,i,s)},o.flipMode.get=function(){return this.uFlipmode.uFlipMode},o.flipMode.set=function(t){this._flipMode=t,this.uniforms.uFlipmode=this._flipMode?1:0},o.posx.get=function(){return this.uniforms.uPosx},o.posx.set=function(t){this.uniforms.uPosx=t},o.radius.get=function(){return this.uniforms.uRadius},o.radius.set=function(t){this.uniforms.uRadius=Math.max(Math.min(t,.04),1e-6)},o.posy.get=function(){return this.uniforms.uPosy},o.posy.set=function(t){this.uniforms.uPosy=t},o.startPosx.get=function(){return this.uniforms.uStartPosx},o.startPosx.set=function(t){this.uniforms.uStartPosx=t},o.startPosy.get=function(){return this.uniforms.uStartPosy},o.startPosy.set=function(t){this.uniforms.uStartPosy=t},o.nextPageTexture.get=function(){return this._nextPageTexture},o.nextPageTexture.set=function(t){t instanceof e.Texture||(t=e.Texture.from(t)),t&&t.baseTexture&&(t.baseTexture.scaleMode=this._scaleMode,t.baseTexture.mipmap=!1,this._size=t.height,this._sliceSize=1/this._size,this._slicePixelSize=this._sliceSize/this._size,this._sliceInnerSize=this._slicePixelSize*(this._size-1),this.uniforms._size=this._size,this.uniforms._sliceSize=this._sliceSize,this.uniforms._slicePixelSize=this._slicePixelSize,this.uniforms._sliceInnerSize=this._sliceInnerSize,this.uniforms.nextPageTexture=t),this._nextPageTexture=t},n.prototype.updateNextPageTexture=function(){var t=this._nextPageTexture;t&&t.baseTexture&&(t._updateID++,t.baseTexture.emit("update",t.baseTexture),this.nextPageTexture=t)},n.prototype.destroy=function(e){this._nextPageTexture&&this._nextPageTexture.destroy(e),t.prototype.destroy.call(this)},Object.defineProperties(n.prototype,o),n}(e.Filter);return t.AmoyPageCurlFilter=n,t}({},PIXI);Object.assign(PIXI.filters,__filters);
//# sourceMappingURL=filter-page-curl.js.map
