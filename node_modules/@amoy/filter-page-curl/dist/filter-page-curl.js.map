{"version":3,"file":"filter-page-curl.js","sources":["../src/PageCurlFilter.js"],"sourcesContent":["import vertex from '../../default.vert';\nimport fragment from './pagecurl.frag';\nimport {Filter, Texture} from '@pixi/core';\n\n/**\n * @class\n * @see {@link https://www.npmjs.com/package/@amoy/filter-page-curl}\n * @see {@link https://www.npmjs.com/package/@amoy/filters}\n * @extends PIXI.Filter\n * @memberof AMOY.filters\n * @param {number} [posx=0.] drag moving x position\n * @param {number} [posy=0.] drag moving y position\n * @param {number} [startPosx=0.] drag start x position\n * @param {number} [startPosy=0.] drag start y position\n */\n\nclass AmoyPageCurlFilter extends Filter{\n    constructor(posx = 0.0, posy = 0.0, startPosx = 0., startPosy = 0.0, nextPageTexture, radius=0.04, flipMode=false) {\n        super(vertex, fragment);\n        // sub class\n        this.posx = posx;\n        this.posy = posy;\n\n        this._size = 0;\n        this._sliceSize = 0;\n        this._slicePixelSize = 0;\n        this._sliceInnerSize = 0;\n        this._flipMode = flipMode;\n\n        this._scaleMode = null;\n\n        this.radius = radius;\n\n        this.startPosx = startPosx;\n        this.startPosy = startPosy;\n\n        this.nextPageTexture = nextPageTexture;\n    }\n\n    /**\n     * Override existing apply method in PIXI.Filter\n     * @private\n     */\n    apply(filterManager, input, output, clear) {\n        this.uniforms.uPosx = this.posx <= 0 ? 0.0 : this.posx;\n        this.uniforms.uPosy = this.posy <= 0 ? 0.0 : this.posy;\n        this.uniforms.uRadius = this.radius;\n        this.uniforms.uFlipmode = this._flipMode ? 1:0;\n        this.uniforms.uStartPosx = this.startPosx <= 0 ? 0.0 : this.startPosx;\n        this.uniforms.uStartPosy = this.startPosy <= 0 ? 0.0 : this.startPosy;\n\n        filterManager.applyFilter(this, input, output, clear);\n    }\n\n    /**\n     * current pos x\n     */\n    get flipMode() {\n        return this.uFlipmode.uFlipMode;\n    }\n\n    set flipMode(value) {\n        this._flipMode = value;\n        this.uniforms.uFlipmode = this._flipMode ? 1:0;\n    }\n\n    /**\n     * current pos x\n     */\n    get posx() {\n        return this.uniforms.uPosx;\n    }\n\n    set posx(value) {\n        this.uniforms.uPosx = value;\n    }\n\n    /**\n     * current pos x\n     */\n    get radius() {\n        return this.uniforms.uRadius;\n    }\n\n    set radius(value) {\n        this.uniforms.uRadius = Math.max(Math.min(value, 0.04), 0.000001);\n    }\n\n\n    /**\n     * current pos y\n     */\n    get posy() {\n        return this.uniforms.uPosy;\n    }\n\n    set posy(value) {\n        this.uniforms.uPosy = value;\n    }\n\n    /**\n     * start pos x\n     */\n    get startPosx() {\n        return this.uniforms.uStartPosx;\n    }\n\n    set startPosx(value) {\n        this.uniforms.uStartPosx = value;\n    }\n\n    /**\n     * start pos y\n     */\n    get startPosy() {\n        return this.uniforms.uStartPosy;\n    }\n\n    set startPosy(value) {\n        this.uniforms.uStartPosy = value;\n    }\n\n    /**\n     * the nextPageTexture texture\n     * @member {PIXI.Texture}\n     */\n    get nextPageTexture() {\n        return this._nextPageTexture;\n    }\n    set nextPageTexture(nextPageTexture) {\n        if (!(nextPageTexture instanceof Texture)) {\n            nextPageTexture = Texture.from(nextPageTexture);\n        }\n        if (nextPageTexture && nextPageTexture.baseTexture) {\n            nextPageTexture.baseTexture.scaleMode = this._scaleMode;\n            nextPageTexture.baseTexture.mipmap = false;\n\n            this._size = nextPageTexture.height;\n            this._sliceSize = 1 / this._size;\n            this._slicePixelSize = this._sliceSize / this._size;\n            this._sliceInnerSize = this._slicePixelSize * (this._size - 1);\n\n            this.uniforms._size = this._size;\n            this.uniforms._sliceSize = this._sliceSize;\n            this.uniforms._slicePixelSize = this._slicePixelSize;\n            this.uniforms._sliceInnerSize = this._sliceInnerSize;\n\n            this.uniforms.nextPageTexture = nextPageTexture;\n        }\n\n        this._nextPageTexture = nextPageTexture;\n    }\n\n    /**\n     * If the nextPageTexture is based on canvas , and the content of canvas has changed,\n     *   then call `updateColorMap` for update texture.\n     */\n    updateNextPageTexture() {\n        const texture = this._nextPageTexture;\n\n        if (texture && texture.baseTexture) {\n            texture._updateID++;\n            texture.baseTexture.emit('update', texture.baseTexture);\n\n            this.nextPageTexture = texture;\n        }\n    }\n\n    /**\n     * Destroys this filter\n     *\n     * @param {boolean} [destroyBase=false] Whether to destroy the base texture of nextPageTexture as well\n     */\n    destroy(destroyBase) {\n        if (this._nextPageTexture) {\n            this._nextPageTexture.destroy(destroyBase);\n        }\n        super.destroy();\n    }\n}\n\nexport { AmoyPageCurlFilter };"],"names":["AmoyPageCurlFilter","posx","posy","startPosx","startPosy","nextPageTexture","radius","flipMode","super","vertex","fragment","this","_size","_sliceSize","_slicePixelSize","_sliceInnerSize","_flipMode","_scaleMode","apply","filterManager","input","output","clear","uniforms","uPosx","uPosy","uRadius","uFlipmode","uStartPosx","uStartPosy","applyFilter","prototypeAccessors","uFlipMode","value","Math","max","min","_nextPageTexture","Texture","from","baseTexture","scaleMode","mipmap","height","updateNextPageTexture","const","texture","_updateID","emit","destroy","destroyBase","Filter"],"mappings":"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"}