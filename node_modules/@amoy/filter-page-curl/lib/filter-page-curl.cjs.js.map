{"version":3,"file":"filter-page-curl.cjs.js","sources":["../src/PageCurlFilter.js"],"sourcesContent":["import vertex from '../../default.vert';\nimport fragment from './pagecurl.frag';\nimport {Filter, Texture} from '@pixi/core';\n\n/**\n * @class\n * @see {@link https://www.npmjs.com/package/@amoy/filter-page-curl}\n * @see {@link https://www.npmjs.com/package/@amoy/filters}\n * @extends PIXI.Filter\n * @memberof AMOY.filters\n * @param {number} [posx=0.] drag moving x position\n * @param {number} [posy=0.] drag moving y position\n * @param {number} [startPosx=0.] drag start x position\n * @param {number} [startPosy=0.] drag start y position\n */\n\nclass AmoyPageCurlFilter extends Filter{\n    constructor(posx = 0.0, posy = 0.0, startPosx = 0., startPosy = 0.0, nextPageTexture, radius=0.04, flipMode=false) {\n        super(vertex, fragment);\n        // sub class\n        this.posx = posx;\n        this.posy = posy;\n\n        this._size = 0;\n        this._sliceSize = 0;\n        this._slicePixelSize = 0;\n        this._sliceInnerSize = 0;\n        this._flipMode = flipMode;\n\n        this._scaleMode = null;\n\n        this.radius = radius;\n\n        this.startPosx = startPosx;\n        this.startPosy = startPosy;\n\n        this.nextPageTexture = nextPageTexture;\n    }\n\n    /**\n     * Override existing apply method in PIXI.Filter\n     * @private\n     */\n    apply(filterManager, input, output, clear) {\n        this.uniforms.uPosx = this.posx <= 0 ? 0.0 : this.posx;\n        this.uniforms.uPosy = this.posy <= 0 ? 0.0 : this.posy;\n        this.uniforms.uRadius = this.radius;\n        this.uniforms.uFlipmode = this._flipMode ? 1:0;\n        this.uniforms.uStartPosx = this.startPosx <= 0 ? 0.0 : this.startPosx;\n        this.uniforms.uStartPosy = this.startPosy <= 0 ? 0.0 : this.startPosy;\n\n        filterManager.applyFilter(this, input, output, clear);\n    }\n\n    /**\n     * current pos x\n     */\n    get flipMode() {\n        return this.uFlipmode.uFlipMode;\n    }\n\n    set flipMode(value) {\n        this._flipMode = value;\n        this.uniforms.uFlipmode = this._flipMode ? 1:0;\n    }\n\n    /**\n     * current pos x\n     */\n    get posx() {\n        return this.uniforms.uPosx;\n    }\n\n    set posx(value) {\n        this.uniforms.uPosx = value;\n    }\n\n    /**\n     * current pos x\n     */\n    get radius() {\n        return this.uniforms.uRadius;\n    }\n\n    set radius(value) {\n        this.uniforms.uRadius = Math.max(Math.min(value, 0.04), 0.000001);\n    }\n\n\n    /**\n     * current pos y\n     */\n    get posy() {\n        return this.uniforms.uPosy;\n    }\n\n    set posy(value) {\n        this.uniforms.uPosy = value;\n    }\n\n    /**\n     * start pos x\n     */\n    get startPosx() {\n        return this.uniforms.uStartPosx;\n    }\n\n    set startPosx(value) {\n        this.uniforms.uStartPosx = value;\n    }\n\n    /**\n     * start pos y\n     */\n    get startPosy() {\n        return this.uniforms.uStartPosy;\n    }\n\n    set startPosy(value) {\n        this.uniforms.uStartPosy = value;\n    }\n\n    /**\n     * the nextPageTexture texture\n     * @member {PIXI.Texture}\n     */\n    get nextPageTexture() {\n        return this._nextPageTexture;\n    }\n    set nextPageTexture(nextPageTexture) {\n        if (!(nextPageTexture instanceof Texture)) {\n            nextPageTexture = Texture.from(nextPageTexture);\n        }\n        if (nextPageTexture && nextPageTexture.baseTexture) {\n            nextPageTexture.baseTexture.scaleMode = this._scaleMode;\n            nextPageTexture.baseTexture.mipmap = false;\n\n            this._size = nextPageTexture.height;\n            this._sliceSize = 1 / this._size;\n            this._slicePixelSize = this._sliceSize / this._size;\n            this._sliceInnerSize = this._slicePixelSize * (this._size - 1);\n\n            this.uniforms._size = this._size;\n            this.uniforms._sliceSize = this._sliceSize;\n            this.uniforms._slicePixelSize = this._slicePixelSize;\n            this.uniforms._sliceInnerSize = this._sliceInnerSize;\n\n            this.uniforms.nextPageTexture = nextPageTexture;\n        }\n\n        this._nextPageTexture = nextPageTexture;\n    }\n\n    /**\n     * If the nextPageTexture is based on canvas , and the content of canvas has changed,\n     *   then call `updateColorMap` for update texture.\n     */\n    updateNextPageTexture() {\n        const texture = this._nextPageTexture;\n\n        if (texture && texture.baseTexture) {\n            texture._updateID++;\n            texture.baseTexture.emit('update', texture.baseTexture);\n\n            this.nextPageTexture = texture;\n        }\n    }\n\n    /**\n     * Destroys this filter\n     *\n     * @param {boolean} [destroyBase=false] Whether to destroy the base texture of nextPageTexture as well\n     */\n    destroy(destroyBase) {\n        if (this._nextPageTexture) {\n            this._nextPageTexture.destroy(destroyBase);\n        }\n        super.destroy();\n    }\n}\n\nexport { AmoyPageCurlFilter };"],"names":["super","Texture","const","Filter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBA,IAAM;IACF,2BAAW,CAAC,IAAU,EAAE,IAAU,EAAE,SAAc,EAAE,SAAe,EAAE,eAAe,EAAE,MAAW,EAAE,QAAc,EAAE;mCAAnG,GAAG;mCAAS,GAAG;6CAAc,GAAG;6CAAa,GAAG;uCAA4B,CAAC;2CAAc,CAAC;;QACxGA,WAAK,OAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;;QAExB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;;QAEjB,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QACpB,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;QACzB,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;QACzB,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;;QAE1B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;;QAEvB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;;QAErB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;;QAE3B,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;;;;;;;uQAC1C;;;;;;iCAMD,wBAAM,aAAa,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE;QACvC,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,IAAI,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC;QACvD,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,IAAI,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC;QACvD,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC;QACpC,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC;QAC/C,IAAI,CAAC,QAAQ,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,IAAI,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC;QACtE,IAAI,CAAC,QAAQ,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,IAAI,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC;;QAEtE,aAAa,CAAC,WAAW,CAAC,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;MACzD;;;;;IAKD,mBAAI,2BAAW;QACX,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC;MACnC;;IAED,mBAAI,yBAAS,KAAK,EAAE;QAChB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC;MAClD;;;;;IAKD,mBAAI,uBAAO;QACP,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;MAC9B;;IAED,mBAAI,qBAAK,KAAK,EAAE;QACZ,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAC;MAC/B;;;;;IAKD,mBAAI,yBAAS;QACT,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;MAChC;;IAED,mBAAI,uBAAO,KAAK,EAAE;QACd,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,EAAE,QAAQ,CAAC,CAAC;MACrE;;;;;;IAMD,mBAAI,uBAAO;QACP,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;MAC9B;;IAED,mBAAI,qBAAK,KAAK,EAAE;QACZ,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAC;MAC/B;;;;;IAKD,mBAAI,4BAAY;QACZ,OAAO,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC;MACnC;;IAED,mBAAI,0BAAU,KAAK,EAAE;QACjB,IAAI,CAAC,QAAQ,CAAC,UAAU,GAAG,KAAK,CAAC;MACpC;;;;;IAKD,mBAAI,4BAAY;QACZ,OAAO,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC;MACnC;;IAED,mBAAI,0BAAU,KAAK,EAAE;QACjB,IAAI,CAAC,QAAQ,CAAC,UAAU,GAAG,KAAK,CAAC;MACpC;;;;;;IAMD,mBAAI,kCAAkB;QAClB,OAAO,IAAI,CAAC,gBAAgB,CAAC;MAChC;IACD,mBAAI,gCAAgB,eAAe,EAAE;QACjC,IAAI,EAAE,eAAe,YAAYC,YAAO,CAAC,EAAE;YACvC,eAAe,GAAGA,YAAO,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;SACnD;QACD,IAAI,eAAe,IAAI,eAAe,CAAC,WAAW,EAAE;YAChD,eAAe,CAAC,WAAW,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC;YACxD,eAAe,CAAC,WAAW,CAAC,MAAM,GAAG,KAAK,CAAC;;YAE3C,IAAI,CAAC,KAAK,GAAG,eAAe,CAAC,MAAM,CAAC;YACpC,IAAI,CAAC,UAAU,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC;YACjC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC;YACpD,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;;YAE/D,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;YACjC,IAAI,CAAC,QAAQ,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;YAC3C,IAAI,CAAC,QAAQ,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC;YACrD,IAAI,CAAC,QAAQ,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC;;YAErD,IAAI,CAAC,QAAQ,CAAC,eAAe,GAAG,eAAe,CAAC;SACnD;;QAED,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;MAC3C;;;;;;iCAMD,0DAAwB;QACpBC,IAAM,OAAO,GAAG,IAAI,CAAC,gBAAgB,CAAC;;QAEtC,IAAI,OAAO,IAAI,OAAO,CAAC,WAAW,EAAE;YAChC,OAAO,CAAC,SAAS,EAAE,CAAC;YACpB,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC;;YAExD,IAAI,CAAC,eAAe,GAAG,OAAO,CAAC;SAClC;MACJ;;;;;;;iCAOD,4BAAQ,WAAW,EAAE;QACjB,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACvB,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;SAC9C;QACDF,gBAAK,CAAC,YAAO,KAAC,CAAC,CAAC;KACnB;;;;;EAlK4BG;;;;"}